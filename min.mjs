/*! Copyright (c) 2017, Andrea Giammarchi, @WebReflection */
const DELETE="del",INSERT="ins",SUBSTITUTE="sub",TypedArray=/^u/.test(typeof Int32Array)?Array:Int32Array,addOperation=(t,e,n,r,a,o)=>{t.unshift({type:e,x:n,y:r,count:a,items:o})},aura=(t,e)=>{const n=e.splice;return e.splice=function r(...a){e.splice=n;const o=t.splice(...a);return e.splice=r,o},e},getOperations=(t,e,n)=>{const r=[],a=t.length+1,o=e.length+1;let i,s,p,c,l,u,y=a-1,d=o-1;for(;d&&y;)u=(l=y*o+d)-o,i=n[l],s=n[u],p=n[l-1],(c=n[u-1])<=p&&c<=s&&c<=i?(d--,y--,c<i&&addOperation(r,"sub",d,y,1,[e[d]])):p<=s&&p<=i?addOperation(r,"ins",--d,y,0,[e[d]]):addOperation(r,"del",d,--y,1,[]);for(;d--;)addOperation(r,"ins",d,y,0,[e[d]]);for(;y--;)addOperation(r,"del",d,y,1,[]);return r},levenstein=(t,e)=>{const n=t.length+1,r=e.length+1,a=new TypedArray(n*r);let o,i,s,p=0,c=0,l=0,u=0,y=0,d=0;for(a[0]=0;++p<r;)a[p]=p;for(;++c<n;){for(l=p=0,d=y,a[(y=c*r)+p]=c;++p<r;)o=a[d+p]+1,i=a[y+l]+1,s=a[d+l]+(t[u]==e[l]?0:1),a[y+p]=o<i?o<s?o:s:i<s?i:s,++l;u=c}return a},majinbuu=(t,e,n)=>{const r=t.length,a=e.length,o=(n||1/0)<Math.sqrt((r||1)*(a||1));r<1||o?(a||o)&&t.splice.apply(t,[0,r].concat(e)):a<1?t.splice(0):performOperations(t,getOperations(t,e,levenstein(t,e)))},performOperations=(t,e)=>{const n=e.length;let r,a,o,i=0,s=1;if(n){for(o=a=e[0];s<n;)r=e[s++],a.type===r.type&&r.x-a.x<=1&&r.y-a.y<=1?(o.count+=r.count,o.items=o.items.concat(r.items)):(t.splice.apply(t,[o.y+i,o.count].concat(o.items)),i+="ins"===o.type?o.items.length:"del"===o.type?-o.count:0,o=r),a=r;t.splice.apply(t,[o.y+i,o.count].concat(o.items))}};majinbuu.aura=aura;export{aura,majinbuu};export default majinbuu;